# Makefile para facilitar la ejecuciÃ³n de tests del optimizador

.PHONY: help test test-unit test-cases test-all test-with-pdfs clean clean-outputs

help:
	@echo "ğŸ§ª Tests del Optimizador de Corte"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "Comandos disponibles:"
	@echo "  make test           - Ejecutar todos los tests (sin PDFs)"
	@echo "  make test-unit      - Solo tests unitarios (unittest)"
	@echo "  make test-cases     - Solo casos predefinidos (CON PDFs) â­"
	@echo "  make test-with-pdfs - Tests unitarios guardando PDFs"
	@echo "  make test-docker    - Ejecutar tests dentro de Docker"
	@echo "  make summary-big    - Ver resumen de casos grandes â­"
	@echo "  make clean          - Limpiar archivos temporales"
	@echo "  make clean-outputs  - Limpiar solo test_outputs/"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

test: test-all

test-all:
	@echo "ğŸš€ Ejecutando todos los tests..."
	@./test/run_all_tests.sh

test-unit:
	@echo "ğŸ§ª Ejecutando tests unitarios..."
	@python test/test_optimizer.py

test-cases:
	@echo "ğŸ“‹ Ejecutando casos predefinidos (generando PDFs)..."
	@python test/run_test_cases.py

test-with-pdfs:
	@echo "ğŸ§ª Ejecutando tests unitarios con PDFs..."
	@SAVE_TEST_ARTIFACTS=true python test/test_optimizer.py

test-docker:
	@echo "ğŸ³ Ejecutando tests en Docker..."
	@cd .. && docker compose run --rm optimizer bash -c "cd /app && python test/test_optimizer.py && python test/run_test_cases.py"

clean:
	@echo "ğŸ§¹ Limpiando archivos temporales..."
	@find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	@find . -type f -name "*.pyc" -delete 2>/dev/null || true
	@rm -rf output_plan/* output_visuals/* 2>/dev/null || true
	@echo "âœ… Limpieza completada"

clean-outputs:
	@echo "ğŸ§¹ Limpiando test_outputs/..."
	@rm -rf test_outputs/ 2>/dev/null || true
	@echo "âœ… test_outputs/ eliminado"

summary-big:
	@echo "ğŸ“Š Mostrando resumen de casos grandes..."
	@./test/show_big_cases_summary.sh
