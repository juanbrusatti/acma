<div class="container mx-auto mt-10 bg-white rounded-lg shadow p-6 sm:p-8 max-w-7xl" id="project-details">
  <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-4">
    <h1 class="text-4xl lg:text-5xl font-bold" id="project-name-view"><%= @project.name %></h1>
    <div class="flex gap-2">
      <%= link_to pdf_project_path(@project, format: :pdf), class: "inline-flex items-center justify-center rounded-md border border-gray-300 bg-white hover:bg-gray-100 h-10 w-10 sm:h-12 sm:w-12 p-2", download: "proyecto_#{@project.id}.pdf", title: "Descargar PDF" do %>
        <%= image_tag "/download.svg", class: "w-6 h-6 sm:w-8 sm:h-8", alt: "Descargar PDF" %>
      <% end %>
      <%= button_to project_path(@project),
                  method: :delete,
                  class: "inline-flex items-center justify-center rounded-md border border-red-300 bg-white hover:bg-red-50 h-10 w-10 sm:h-12 sm:w-12 p-2",
                  data: { turbo_confirm: "¿Estás seguro de que deseas eliminar este proyecto? Esta acción no se puede deshacer.",
                          turbo_method: :delete },
                  title: "Eliminar proyecto" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-8 sm:w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      <% end %>
    </div>
  </div>
  <input type="text" id="project-name-edit" value="<%= @project.name %>" style="display:none;" class="text-4xl lg:text-5xl font-bold mb-4 w-full border rounded px-3 py-2" />

  <p class="text-lg text-gray-700 mb-2"><strong>Descripción:</strong> <span id="project-desc-view"><%= @project.description %></span></p>
  <textarea id="project-desc-edit" style="display:none;" class="w-full border rounded px-2 py-1 mb-2"><%= @project.description %></textarea>

  <div class="mb-4 flex items-center gap-2">
    <strong>Estado:</strong>
    <% badge_class =
      case @project.status
      when 'Terminado'
        'bg-green-100 text-green-700'
      when 'En Proceso'
        'bg-blue-100 text-blue-700'
      when 'Pendiente'
        'bg-yellow-100 text-yellow-700'
      else
        'bg-gray-100 text-gray-500'
      end
    %>
    <select id="status-selector-direct" class="inline-block rounded-full px-3 py-1 text-xs font-semibold <%= badge_class %> shadow-sm border border-transparent whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer" data-project-id="<%= @project.id %>">
      <option value="Pendiente" <%= 'selected' if @project.status == 'Pendiente' %>>Pendiente</option>
      <option value="En Proceso" <%= 'selected' if @project.status == 'En Proceso' %>>En Proceso</option>
      <option value="Terminado" <%= 'selected' if @project.status == 'Terminado' %>>Terminado</option>
    </select>
  </div>
  <% if @project.date_of_optimization.present? && @project.status == 'Terminado' %>
    <p class="mb-2"><strong>Fecha de optimización:</strong> <span id="project-optimization-date-view"><%= @project.date_of_optimization.strftime('%Y-%m-%d') %></span></p>
    <input type="date" id="project-optimization-date-edit" value="<%= @project.date_of_optimization.strftime('%Y-%m-%d') %>" style="display:none;" class="w-full border rounded px-2 py-1 mb-2" />
  <% end %>
  <% if @project.delivery_date.present? %>
    <p class="mb-2"><strong>Fecha de entrega:</strong> <span id="project-date-view"><%= @project.delivery_date.strftime('%Y-%m-%d') %></span></p>
    <input type="date" id="project-date-edit" value="<%= @project.delivery_date.strftime('%Y-%m-%d') %>" style="display:none;" class="w-full border rounded px-2 py-1 mb-2" />
  <% end %>
  <p class="mb-2 text-sm text-gray-400">ID: <%= @project.id %></p>

  <div class="mb-4 flex gap-8 items-center">
    <div>
      <span class="font-semibold">Precio sin IVA:</span>
      <span id="project-price-view" class="ml-2"><%= format_argentine_currency((@project.price_without_iva || @project.subtotal), unit: "$", precision: 2) %></span>
    </div>
    <div>
      <span class="font-semibold">IVA (21%):</span>
      <span id="project-iva-view" class="ml-2"><%= format_argentine_currency((@project.price_without_iva || @project.subtotal) * 0.21, unit: "$", precision: 2) %></span>
    </div>
    <div>
      <span class="font-semibold">Total:</span>
      <span id="project-price-iva-view" class="ml-2 text-lg font-bold"><%= format_argentine_currency((@project.price_without_iva || @project.subtotal) * 1.21, unit: "$", precision: 2) %></span>
    </div>
  </div>

  <% if @project.dvhs.any? %>
    <div class="mt-8">
      <h2 class="text-2xl font-semibold mb-4 text-gray-800">DVHs del Proyecto</h2>
      <%= render partial: "projects/partials/dvhs_table", locals: { project: @project } %>
    </div>
  <% end %>

  <% if @project.glasscuttings.any? %>
    <div class="mt-8">
      <h2 class="text-2xl font-semibold mb-4 text-gray-800">Vidrios del Proyecto</h2>
      <%= render partial: "projects/partials/glasscuttings_table", locals: { project: @project } %>
    </div>
  <% end %>

  <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-between" id="project-actions-view">
    <%= link_to "Editar", new_project_path(project_id: @project.id), class: "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-6" %>
    <%= button_to "Optimizar Corte", optimize_project_path(@project), method: :post, data: { turbo: false }, class: "btn-optimize text-primary-foreground" %>
    <%= link_to "Volver", projects_path, class: "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-6" %>
  </div>
  <div class="mt-8 flex flex-col sm:flex-row gap-4" id="project-actions-edit" style="display:none;">
    <%= button_tag "Confirmar", id: "confirm-btn", class: "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium bg-green-600 text-white h-10 px-6" %>
    <%= button_tag "Cancelar", id: "cancel-btn", class: "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-6" %>
  </div>
</div>
