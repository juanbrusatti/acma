
<div style="margin-bottom: 10px;">
  <img src="file://<%= Rails.root.join('public', 'banner.png') %>" alt="Banner" style="width:100%;">
</div>
<h1 style="text-align:center; margin-bottom: 0;">PRESUPUESTO</h1>
<hr>
<table style="width:100%; margin-bottom: 10px;">
  <tr>
    <td><strong>Cliente:</strong> <%= @project.name %></td>
    <td><strong>Telefono:</strong> <%= @project.phone %></td>
  </tr>
  <tr>
    <td><strong>Domicilio:</strong> <%= @project.address %></td>
    <td><strong>Estado:</strong> <%= @project.status %></td>
  </tr>
  <tr>
    <td colspan="2"><strong>Descripcion:</strong> <%= @project.description %></td>
  </tr>
</table>

<h2 style="margin-bottom: 5px; margin-top: 30px; font-size: 20px; color: #222;">Vidrios asignados al proyecto</h2>
<table border="0" cellspacing="0" cellpadding="0" style="width:100%; border-collapse: separate; border-spacing: 0; margin-bottom: 20px; font-size: 14px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px #eee;">
  <thead>
    <tr style="background: #f3f3f3; color: #222; font-weight: bold;">
      <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Tipo</th>
      <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Espesor</th>
      <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Color</th>
      <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Ubicacion</th>
      <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Alto</th>
      <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Ancho</th>
      <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Precio</th>
    </tr>
  </thead>
  <tbody>
    <% total = 0 %>
    <% @project.glasscuttings.each_with_index do |glass, idx| %>
      <% precio = glass.price.to_f %>
      <% total += precio %>
      <tr style="background: <%= idx.even? ? '#fff' : '#f9f9f9' %>;">
        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= human_glass_type(glass.glass_type) %></td>
        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= glass.thickness %></td>
        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= human_glass_color(glass.color) %></td>
        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= glass.location %></td>
        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= glass.height %></td>
        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= glass.width %></td>
        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= number_to_currency(precio, unit: "$", precision: 2) if glass.price.present? %></td>
      </tr>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="6" style="text-align:right; padding: 8px; font-weight: bold; background: #f3f3f3; border-top: 2px solid #ddd;">Total:</td>
      <td style="padding: 8px; font-weight: bold; background: #f3f3f3; border-top: 2px solid #ddd; text-align: right;"><%= number_to_currency(total, unit: "$", precision: 2) %></td>
    </tr>
  </tfoot>
</table>



<% if @project.dvhs.any? %>
  <h2 style="margin-top: 40px; margin-bottom: 5px; font-size: 20px; color: #222;">DVH asignados al proyecto</h2>
  <table border="0" cellspacing="0" cellpadding="0" style="width:100%; border-collapse: separate; border-spacing: 0; margin-bottom: 20px; font-size: 14px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px #eee;">
    <thead>
      <tr style="background: #f3f3f3; color: #222; font-weight: bold;">
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">ID</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Camara</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Ubicacion</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Alto</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Ancho</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Cristal 1</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Cristal 2</th>
        <th style="padding: 8px; border-bottom: 2px solid #ddd; text-align: center;">Precio</th>
      </tr>
    </thead>
    <tbody>
      <% dvh_total = 0 %>
      <% @project.dvhs.each_with_index do |dvh, idx| %>
        <% precio = dvh.respond_to?(:price) && dvh.price.present? ? dvh.price.to_f : 0 %>
        <% dvh_total += precio %>
        <tr style="background: <%= idx.even? ? '#fff' : '#f9f9f9' %>;">
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= idx + 1 %></td>
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= dvh.innertube %></td>
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= dvh.location %></td>
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= dvh.height %></td>
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= dvh.width %></td>
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= [dvh.glasscutting1_type, dvh.glasscutting1_thickness, dvh.glasscutting1_color].compact.join(' / ') %></td>
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= [dvh.glasscutting2_type, dvh.glasscutting2_thickness, dvh.glasscutting2_color].compact.join(' / ') %></td>
          <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;"><%= number_to_currency(precio, unit: "$", precision: 2) if precio > 0 %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="7" style="text-align:right; padding: 8px; font-weight: bold; background: #f3f3f3; border-top: 2px solid #ddd;">Total:</td>
        <td style="padding: 8px; font-weight: bold; background: #f3f3f3; border-top: 2px solid #ddd; text-align: right;"><%= number_to_currency(dvh_total, unit: "$", precision: 2) %></td>
      </tr>
    </tfoot>
  </table>
  <p style="margin-top: 20px;"><strong>Nota:</strong> Precios IVA incluido.</p> 
<% end %> 