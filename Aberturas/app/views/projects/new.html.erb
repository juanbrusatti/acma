<%# Page title %>
<% content_for :title, "Nuevo proyecto" %>
  
<div class="w-full p-4 md:p-8>
  <%# Page header %>
  <h1 class="text-2xl font-semibold mb-6">Generar proyecto</h1>
  
  <%# Project form using form_with helper %>
  <%= form_with(model: @project, local: true) do |f| %>
    <div class="grid grid-cols-1 md:grid-cols-2 grid-rows-2 gap-2">
  
      <%# Main card: Client Data %>
      <div class="bg-white rounded-md border border-gray-200 shadow-sm p-6 space-y-4 md:col-span-2">
        <h2 class="text-lg font-semibold mb-4">Datos del Cliente</h2>
        <div class="space-y-4">
          <div>
            <%# Client name label and input %>
            <%= f.label :name, "Nombre del Cliente", class: "block text-sm font-medium mb-1" %>
            <%= f.text_field :name, class: "w-full border border-gray-300 rounded px-3 py-2" %>
          </div>
  
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <%# Client phone label and input %>
              <%= f.label :phone, "Teléfono", class: "block text-sm font-medium mb-1" %>
              <%= f.telephone_field :phone, class: "w-full border border-gray-300 rounded px-3 py-2" %>
            </div>
            <div>
              <%# Client email label and input %>
              <%= f.label :email, "Correo electrónico", class: "block text-sm font-medium mb-1" %>
              <%= f.email_field :email, class: "w-full border border-gray-300 rounded px-3 py-2" %>
            </div>
          </div>
  
          <div>
            <%# Estimated delivery date label and input %>
            <%= f.label :delivery_date, "Fecha de entrega estimada", class: "block text-sm font-medium mb-1" %>
            <%= f.date_field :delivery_date, class: "w-full border border-gray-300 rounded px-3 py-2" %>
          </div>
        </div>
      </div>
  
      <%# Side card: Summary and Actions %>
      <div class="bg-white rounded-md border border-gray-200 shadow-sm p-6 space-y-4">
        <h2 class="text-lg font-semibold mb-4">Resumen y Acciones</h2>
  
        <%# Subtotal row %>
        <div class="flex items-center justify-between">
          <span class="text-gray-600">Subtotal</span>
          <span>$<%= number_with_precision(@project.try(:subtotal) || 0, precision: 2, delimiter: ".") %></span>
        </div>
  
        <%# IVA (tax) row %>
        <div class="flex items-center justify-between">
          <span class="text-gray-600">IVA (21%)</span>
          <span>$<%= number_with_precision(@project.try(:iva) || 0, precision: 2, delimiter: ".") %></span>
        </div>
  
        <hr />
  
        <%# Total row %>
        <div class="flex items-center justify-between font-bold">
          <span class="text-lg">Total Estimado</span>
          <span class="text-lg">$<%= number_with_precision(@project.try(:total) || 0, precision: 2, delimiter: ".") %></span>
        </div>
  
        <%# Action buttons: Save, Optimize, Send, Save PDF, Back, Cancel %>
        <div class="flex flex-col gap-3">
          <%= f.submit "Guardar como presupuesto", class: "w-full bg-black text-white rounded px-4 py-3 font-medium" %> <%# Save as estimate %>
          <button type="button" class="w-full border border-gray-300 rounded px-4 py-3">Optimizar</button> <%# Optimize button %>
          <button type="button" class="w-full border border-gray-300 rounded px-4 py-3">Enviar</button> <%# Send button %>
          <button type="button" class="w-full border border-gray-300 rounded px-4 py-3">Guardar PDF</button> <%# Save PDF button %>
          <%= link_to "Volver a proyectos", projects_path, class: "w-full border border-gray-300 rounded px-4 py-3 text-center" %> <%# Back to projects link %>
          <%= link_to "Cancelar", projects_path, class: "w-full border border-red-400 text-red-500 rounded px-4 py-3 text-center" %> <%# Cancel link %>
        </div>
      </div>
  
    </div>
  
    <%# Card: Glass requested (Openings) %>
    <div class="bg-white rounded-md border border-gray-200 shadow-sm p-6 md:col-span-3 mt-10">
      <h2 class="text-lg font-semibold mb-4">Vidrios solicitados</h2>
  
      <%# Table for glass requested %>
      <table class="w-full text-left mb-4">
        <thead>
          <tr class="border-b">
            <th class="py-2">Cantidad</th> <%# Quantity %>
            <th class="py-2">Tipo de vidrio</th> <%# Glass type %>
            <th class="py-2">Ancho (mm)</th> <%# Width (mm) %>
            <th class="py-2">Alto (mm)</th> <%# Height (mm) %>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
  
      <%# Inputs to add a new glass opening %>
      <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
        <%= f.fields_for :openings do |o| %>
          <%= o.number_field :quantity, placeholder: "Cantidad", class: "w-full border border-gray-300 rounded px-3 py-2" %> <%# Quantity input %>
          <%= o.text_field :glass_type, placeholder: "Tipo (Simple/DVH)", class: "w-full border border-gray-300 rounded px-3 py-2" %> <%# Glass type input %>
          <%= o.number_field :width, placeholder: "Ancho (mm)", class: "w-full border border-gray-300 rounded px-3 py-2" %> <%# Width input %>
          <%= o.number_field :height, placeholder: "Alto (mm)", class: "w-full border border-gray-300 rounded px-3 py-2" %> <%# Height input %>
        <% end %>
        <button type="button" class="w-full bg-black text-white rounded px-3 py-2">Agregar</button> <%# Add button %>
      </div>
  
      <p class="text-sm text-gray-500 mt-2">Usá Glassplate o DVH según corresponda.</p> <%# Instructional note %>
    </div>
  <% end %>
</div>
